<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WWJ的个人主页</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- 添加网站图标 -->
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body>
    <!-- 导航栏 -->
    <header class="nav-header">
        <nav class="nav-container">
            <div class="logo">
                <a href="#" class="logo-link">MyPage</a>
            </div>
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link active" data-index="0">首页</a></li>
                <li><a href="#write-email" class="nav-link" data-index="1">写邮件</a></li>
                <li><a href="#portfolio" class="nav-link" data-index="2">作品集</a></li>
                <li><a href="#contact" class="nav-link" data-index="3">联系我</a></li>
            </ul>
        </nav>
    </header>

    <!-- 页面容器 -->
    <div class="fullpage-container">
        <!-- 主视觉区域 -->
        <section class="section hero" id="home">
            <div class="hero-content">
                <h1 class="hero-title">智能邮件助手</h1>
                <p class="hero-subtitle">专业的邮件回复，让沟通更轻松</p>
                <a href="#write-email" class="cta-button next-section">开始使用</a>
            </div>
        </section>

        <!-- 写邮件区域 -->
        <section class="section write-email" id="write-email">
            <div class="email-editor-container">
                <!-- 左侧输入区域 -->
                <div class="input-panel">
                    <div class="panel-header">
                        <h2>写邮件</h2>
                        <button class="attachment-btn" title="添加附件">
                            <svg viewBox="0 0 24 24" class="paperclip-icon">
                                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                            </svg>
                        </button>
                    </div>
                    <div class="editor-content">
                        <div class="email-form">
                            <div class="form-group">
                                <div class="content-editor" contenteditable="true" placeholder="请输入您想要发送的邮件内容..."></div>
                            </div>
                            <div class="attachments-list">
                                <!-- 附件列表将在这里动态显示 -->
                            </div>
                        </div>
                        <input type="file" id="file-upload" multiple style="display: none" accept=".doc,.docx,.pdf,.xls,.xlsx">
                        <button class="send-btn">生成回复</button>
                    </div>
                </div>

                <!-- 右侧输出区域 -->
                <div class="output-panel">
                    <div class="panel-header">
                        <h2>AI 回复预览</h2>
                        <button class="copy-btn" title="复制到剪贴板">
                            <svg viewBox="0 0 24 24" class="copy-icon">
                                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-2"/>
                                <path d="M16 2H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="ai-response">
                        <div class="email-preview">
                            <div class="preview-content">
                                <p class="placeholder-text">AI 将根据您的输入生成邮件内容...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 作品集区域 -->
        <section class="section portfolio" id="portfolio">
            <div class="container">
                <h2 class="section-title">作品集</h2>
                <div class="portfolio-grid">
                    <div class="portfolio-item">
                        <img src="images/project1.jpg" alt="项目1">
                        <h3>项目名称</h3>
                        <p>项目描述</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 联系我区域 -->
        <section class="section contact" id="contact">
            <div class="container">
                <h2 class="section-title">联系我</h2>
                <div class="contact-content">
                    <form class="contact-form">
                        <input type="text" placeholder="您的姓名" required>
                        <input type="email" placeholder="您的邮箱" required>
                        <textarea placeholder="您的留言" required></textarea>
                        <button type="submit" class="submit-button">发送消息</button>
                    </form>
                </div>
            </div>
        </section>
    </div>

    <!-- 页面指示器 -->
    <div class="page-indicator">
        <span class="indicator active" data-index="0"></span>
        <span class="indicator" data-index="1"></span>
        <span class="indicator" data-index="2"></span>
        <span class="indicator" data-index="3"></span>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.querySelector('.fullpage-container');
            const sections = document.querySelectorAll('.section');
            const indicators = document.querySelectorAll('.indicator');
            const navLinks = document.querySelectorAll('.nav-link');
            const contentEditor = document.querySelector('.content-editor');
            const previewContent = document.querySelector('.preview-content');
            const emailEditorContainer = document.querySelector('.email-editor-container');
            let currentSection = 0;
            let isAnimating = false;

            // 更新活动状态
            function updateActiveState(index) {
                navLinks.forEach(link => link.classList.remove('active'));
                navLinks[index].classList.add('active');
                indicators.forEach(indicator => indicator.classList.remove('active'));
                indicators[index].classList.add('active');
            }

            // 切换到指定页面
            function goToSection(index) {
                if (isAnimating || index === currentSection) return;
                isAnimating = true;

                const translateY = -100 * index;
                container.style.transform = `translateY(${translateY}vh)`;
                currentSection = index;
                updateActiveState(index);

                setTimeout(() => {
                    isAnimating = false;
                }, 1000);
            }

            // 检查是否在可滚动区域内
            function isInScrollableArea(target) {
                // 只检查内容编辑器和预览内容区域
                const editorArea = contentEditor.contains(target) || target === contentEditor;
                const previewArea = previewContent.contains(target) || target === previewContent;
                const emailPreview = document.querySelector('.email-preview');
                const emailPreviewArea = emailPreview && (emailPreview.contains(target) || target === emailPreview);
                
                return editorArea || previewArea || emailPreviewArea;
            }

            // 监听鼠标滚轮
            function handleWheel(e) {
                if (isAnimating) return;

                // 检查是否在可滚动区域内
                if (isInScrollableArea(e.target)) {
                    // 在可滚动区域内，阻止页面切换
                    e.stopPropagation();
                    return;
                }

                // 在其他区域正常切换页面
                if (e.deltaY > 0 && currentSection < sections.length - 1) {
                    goToSection(currentSection + 1);
                } else if (e.deltaY < 0 && currentSection > 0) {
                    goToSection(currentSection - 1);
                }
            }

            // 监听触摸事件
            let touchStartY = 0;
            container.addEventListener('touchstart', e => {
                // 如果触摸开始于可滚动区域，不处理页面切换
                if (isInScrollableArea(e.target)) {
                    return;
                }
                touchStartY = e.touches[0].clientY;
            });

            container.addEventListener('touchmove', e => {
                // 如果触摸移动在可滚动区域内，不处理页面切换
                if (isAnimating || isInScrollableArea(e.target)) {
                    return;
                }
                
                const touchEndY = e.touches[0].clientY;
                const diff = touchStartY - touchEndY;

                if (Math.abs(diff) > 50) {
                    if (diff > 0 && currentSection < sections.length - 1) {
                        goToSection(currentSection + 1);
                    } else if (diff < 0 && currentSection > 0) {
                        goToSection(currentSection - 1);
                    }
                    touchStartY = touchEndY;
                }
            });

            // 绑定事件监听器
            window.addEventListener('wheel', handleWheel);
            
            // 导航菜单点击事件
            navLinks.forEach(link => {
                link.addEventListener('click', e => {
                    e.preventDefault();
                    const index = parseInt(link.getAttribute('data-index'));
                    
                    // 如果点击的是首页，清空邮件编辑器的内容
                    if (index === 0) {
                        // 清空输入框
                        const contentEditor = document.querySelector('.content-editor');
                        if (contentEditor) {
                            contentEditor.innerHTML = '';
                        }
                        
                        // 清空附件列表
                        const attachmentsList = document.querySelector('.attachments-list');
                        if (attachmentsList) {
                            attachmentsList.innerHTML = '';
                        }
                        
                        // 重置预览区域
                        const previewContent = document.querySelector('.preview-content');
                        if (previewContent) {
                            previewContent.innerHTML = '<p class="placeholder-text">AI 将根据您的输入生成邮件内容...</p>';
                        }
                    }
                    
                    goToSection(index);
                });
            });

            // 页面指示器点击事件
            indicators.forEach(indicator => {
                indicator.addEventListener('click', () => {
                    const index = parseInt(indicator.getAttribute('data-index'));
                    goToSection(index);
                });
            });

            // "了解更多"按钮点击事件
            document.querySelector('.next-section').addEventListener('click', e => {
                e.preventDefault();
                goToSection(1);
            });
        });
    </script>

    <!-- 添加必要的 JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 获取必要的DOM元素
        const attachmentBtn = document.querySelector('.attachment-btn');
        const fileUpload = document.querySelector('#file-upload');
        const attachmentsList = document.querySelector('.attachments-list');
        const contentEditor = document.querySelector('.content-editor');
        const sendBtn = document.querySelector('.send-btn');
        const previewContent = document.querySelector('.preview-content');
        const copyBtn = document.querySelector('.copy-btn');

        // 存储附件列表
        let attachments = [];

        // 附件按钮点击事件
        attachmentBtn.addEventListener('click', () => {
            fileUpload.click();
        });

        // 文件上传处理
        fileUpload.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                if (attachments.length >= 5) {
                    alert('最多只能添加5个附件');
                    return;
                }
                attachments.push(file);
                displayAttachment(file);
            });
            fileUpload.value = ''; // 清空input，允许重复选择相同文件
        });

        // 显示附件
        function displayAttachment(file) {
            const div = document.createElement('div');
            div.className = 'attachment-item';
            div.innerHTML = `
                <span class="file-name">${file.name}</span>
                <button class="remove-file" data-name="${file.name}">×</button>
            `;
            attachmentsList.appendChild(div);

            // 删除附件事件
            div.querySelector('.remove-file').addEventListener('click', function() {
                const fileName = this.getAttribute('data-name');
                attachments = attachments.filter(f => f.name !== fileName);
                div.remove();
            });
        }

        // 生成回复按钮点击事件
        sendBtn.addEventListener('click', async () => {
            const content = contentEditor.innerText.trim();
            if (!content) {
                alert('请输入邮件内容');
                return;
            }

            // 显示加载状态
            previewContent.innerHTML = '<div class="loading">正在生成回复...</div>';

            try {
                const response = await generateEmailResponse(content, attachments);
                displayResponse(response);
            } catch (error) {
                previewContent.innerHTML = `
                    <div class="error-message">
                        生成回复时出错
                        <div class="error-detail">${error.message}</div>
                    </div>
                `;
            }
        });

        // 生成邮件回复
        async function generateEmailResponse(content, attachments = []) {
            // 构建系统提示词
            const systemPrompt = `你是一个专业的邮件助手，需要帮助用户处理邮件回复。请严格按照以下规则处理：

邮件收件人识别（按优先级）：
1. 用户明确指定：
   - 首先检查用户输入中是否明确指定了收件人
   - 如果用户明确提到"回复给xxx"或类似表述，则使用该人作为收件人

2. 邮件签名信息：
   - 如果用户没有明确指定，查找原始邮件中的签名信息
   - 识别邮件底部的发件人姓名、职位等信息

3. 邮件头部信息：
   - 如果没有签名信息，查看邮件头部的发件人(From)字段
   - 使用发件人字段中的姓名作为收件人

4. 其他识别信息：
   - 如果以上都没有，查找邮件正文中的称谓、问候语等
   - 提取可能是发件人的名字或称谓

邮件内容理解：
1. 上下文分析：
   - 理解原始邮件的主要问题或请求
   - 识别所有相关方及其关系
   - 确保回复准确对应原始问题

2. 特殊名称处理：
   - 保持所有人名的原始拼写
   - 保持公司名称、产品名称的原始拼写
   - 保持专业术语的原始表达
   - 确保中英文一致性

回复格式规范：
1. 英文格式：
   - 开头：Dear [收件人],
   - 正文：简洁明了的回应
   - 结尾：仅使用 "Best regards," 作为结束语

2. 中文格式：
   - 开头：[收件人]，
   - 正文：简洁明了的回应
   - 结尾：仅使用 "此致," 作为结束语

3. 双语处理：
   [英文回复]
   
   =========
   中文译文：
   
   [中文回复]

注意事项：
1. 确保收件人准确性
2. 保持回复简洁明了
3. 不添加未提及的信息
4. 不添加签名、职位、公司等信息
5. 结尾只用简单的客套语，不要添加"[你的名字]"、"[你的职位]"等占位符

请根据以上规则，生成专业的邮件回复。`;

            try {
                // 检查是否要求英文回复
                const isEnglishRequired = content.toLowerCase().includes('用英文') || 
                                        content.toLowerCase().includes('用英语') || 
                                        content.toLowerCase().includes('in english');
                
                // 移除"用英文回复"等指令
                let cleanContent = content;
                if (isEnglishRequired) {
                    cleanContent = content.replace(/用英文回复|用英文|用英语|in english/gi, '').trim();
                }

                // 构建用户提示词
                const userPrompt = `请帮我回复以下邮件内容：${cleanContent}
${isEnglishRequired ? '请用英文回复，并在回复后附上中文译文。' : '请用中文回复。'}
${attachments.length > 0 ? `附件列表：\n${attachments.map(file => `- ${file.name}`).join('\n')}` : ''}`;

                // 调用 API
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-ce5f0690af0d454cb4a08054db2b9102'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: systemPrompt
                            },
                            {
                                role: 'user',
                                content: userPrompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000,
                        top_p: 0.95,
                        frequency_penalty: 0,
                        presence_penalty: 0
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'AI 服务请求失败');
                }

                const result = await response.json();
                return result.choices[0].message.content;

            } catch (error) {
                console.error('生成回复失败:', error);
                throw new Error('生成回复时发生错误，请稍后重试');
            }
        }

        // 显示回复内容
        function displayResponse(response) {
            // 添加邮件主题
            const subject = '邮件回复';
            
            previewContent.innerHTML = `
                <div class="email-subject">${subject}</div>
                <div class="email-body">${response.replace(/\n/g, '<br>')}</div>
            `;
        }

        // 复制按钮功能
        copyBtn.addEventListener('click', () => {
            const emailBody = previewContent.querySelector('.email-body');
            if (!emailBody) {
                alert('没有可复制的内容');
                return;
            }

            // 创建临时文本区域
            const textarea = document.createElement('textarea');
            textarea.value = emailBody.innerText;
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                alert('内容已复制到剪贴板');
            } catch (err) {
                alert('复制失败，请手动复制');
            }
            
            document.body.removeChild(textarea);
        });

        // 内容编辑器的 placeholder 处理
        contentEditor.addEventListener('focus', function() {
            if (this.innerHTML === '') {
                this.innerHTML = '';
            }
        });

        contentEditor.addEventListener('blur', function() {
            if (this.innerHTML === '') {
                this.innerHTML = '';
            }
        });

        // 添加粘贴事件处理
        contentEditor.addEventListener('paste', function(e) {
            // 阻止默认粘贴行为
            e.preventDefault();
            
            const clipboardData = e.clipboardData || window.clipboardData;
            const items = clipboardData.items;

            // 检查是否有图片
            let hasImage = false;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    hasImage = true;
                    // 获取图片文件
                    const file = items[i].getAsFile();
                    // 处理图片
                    handlePastedImage(file);
                    break;
                }
            }

            // 如果不是图片，则作为纯文本处理
            if (!hasImage) {
                const text = clipboardData.getData('text/plain');
                // 使用 document.execCommand 插入纯文本
                if (document.queryCommandSupported('insertText')) {
                    document.execCommand('insertText', false, text);
                } else {
                    // 如果 insertText 命令不支持，则使用替代方法
                    const selection = window.getSelection();
                    if (selection.rangeCount) {
                        const range = selection.getRangeAt(0);
                        range.deleteContents();
                        const textNode = document.createTextNode(text);
                        range.insertNode(textNode);
                        range.collapse(false);
                        selection.removeAllRanges();
                        selection.addRange(range);
                    }
                }
            }
        });

        // 处理粘贴的图片
        function handlePastedImage(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                img.style.margin = '10px 0';
                img.style.borderRadius = '4px';
                
                // 获取当前选区
                const selection = window.getSelection();
                if (selection.rangeCount) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(img);
                    // 移动光标到图片后面
                    range.setStartAfter(img);
                    range.setEndAfter(img);
                    selection.removeAllRanges();
                    selection.addRange(range);
                    // 添加换行
                    const br = document.createElement('br');
                    img.parentNode.insertBefore(br, img.nextSibling);
                }
            };
            reader.readAsDataURL(file);
        }
    });
    </script>
</body>
</html> 